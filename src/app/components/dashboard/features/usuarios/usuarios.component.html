<section class="mx-auto w-full max-w-screen-xl px-4">
  <section class="mx-auto w-full max-w-screen-xl px-4">
    <div class="bg-white rounded-lg shadow-sm border overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-800">Gestión de Usuarios</h3>
        <div class="flex gap-4 mt-4">
          <input type="date" [(ngModel)]="searchDate" class="border rounded px-3 py-1 text-sm" />
          <button (click)="consultarPorFecha()"
            class="bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700">Consultar</button>
        </div>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full">
          <!-- cabecera de tabla existente -->
          <!-- cuerpo de tabla existente -->
        </table>
      </div>
    </div>

    <div *ngIf="showModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
      <div class="bg-white max-h-[80vh] w-[90%] md:w-[70%] rounded-lg overflow-auto shadow-lg p-6 relative">
        <button (click)="cerrarModal()" class="absolute top-3 right-3 text-gray-600 hover:text-red-500">
          ✕
        </button>
        <h2 class="text-lg font-bold mb-4">Resultados por Fecha</h2>
        <table class="w-full text-sm text-left">
          <thead class="bg-gray-100">
            <tr>
              <th class="p-2">Nombre</th>
              <th class="p-2">Email</th>
              <th class="p-2">Método</th>
              <th class="p-2">Login</th>
              <th class="p-2">Logout</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of modalResults" class="border-t">
              <td class="p-2">{{ user.displayName || 'Sin nombre' }}</td>
              <td class="p-2">{{ user.email }}</td>
              <td class="p-2">{{ user.method | titlecase }}</td>
              <td class="p-2">{{ user.loginAt?.toDate() | date:'medium' }}</td>
              <td class="p-2">{{ user.logoutAt?.toDate() | date:'medium' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <section class="mx-auto mt-6 w-full max-w-screen-xl px-4">
    <div class="bg-white rounded-lg shadow-sm border overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-800">Gestión de Usuarios</h3>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer"
                (click)="sortData('displayName')">
                <div class="flex items-center">
                  Nombre
                  <span class="ml-1">
                    @if (sortColumn === 'displayName') {
                    @if (sortDirection === 'asc') {
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd"
                        d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z"
                        clip-rule="evenodd" />
                    </svg>
                    } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd"
                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                        clip-rule="evenodd" />
                    </svg>
                    }
                    }
                  </span>
                </div>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer"
                (click)="sortData('email')">
                <div class="flex items-center">
                  Email
                  <span class="ml-1">
                    @if (sortColumn === 'email') {
                    @if (sortDirection === 'asc') {
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd"
                        d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z"
                        clip-rule="evenodd" />
                    </svg>
                    } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd"
                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                        clip-rule="evenodd" />
                    </svg>
                    }
                    }
                  </span>
                </div>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Método</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer"
                (click)="sortData('loginAt')">
                <div class="flex items-center">
                  Último Login
                  <span class="ml-1">
                    @if (sortColumn === 'loginAt') {
                    @if (sortDirection === 'asc') {
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd"
                        d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z"
                        clip-rule="evenodd" />
                    </svg>
                    } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd"
                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                        clip-rule="evenodd" />
                    </svg>
                    }
                    }
                  </span>
                </div>
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer"
                (click)="sortData('logoutAt')">
                <div class="flex items-center">
                  Último Logout
                  <span class="ml-1">
                    @if (sortColumn === 'logoutAt') {
                    @if (sortDirection === 'asc') {
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd"
                        d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z"
                        clip-rule="evenodd" />
                    </svg>
                    } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd"
                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                        clip-rule="evenodd" />
                    </svg>
                    }
                    }
                  </span>
                </div>
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            @if (access$ | async; as access) {
            @if (sortedAccess.length > 0) {
            @for (user of sortedAccess; track user.uidUser) {
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 text-sm text-gray-900">{{ user.displayName || 'Sin nombre' }}</td>
              <td class="px-6 py-4 text-sm text-gray-900">{{ user.email }}</td>
              <td class="px-6 py-4">
                <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full"
                  [class.bg-blue-100]="user.method === 'email'" [class.text-blue-800]="user.method === 'email'"
                  [class.bg-green-100]="user.method === 'google'" [class.text-green-800]="user.method === 'google'"
                  [class.bg-purple-100]="user.method === 'github'" [class.text-purple-800]="user.method === 'github'">
                  {{ user.method || 'desconocido' | titlecase }}
                </span>
              </td>
              <td class="px-6 py-4 text-sm text-gray-900">
                @if (user.loginAt) {
                {{ user.loginAt.toDate() | date:'medium' }}
                } @else {
                Nunca
                }
              </td>
              <td class="px-6 py-4 text-sm text-gray-900">
                @if (user.logoutAt) {
                {{ user.logoutAt.toDate() | date:'medium' }}
                } @else {
                Nunca
                }
              </td>
            </tr>
            }
            } @else {
            <tr>
              <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                No hay usuarios registrados
              </td>
            </tr>
            }
            } @else {
            <tr>
              <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                Cargando usuarios...
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </section>